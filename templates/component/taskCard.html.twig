{#
    Task Card Component
    
    Parameters:
    - task: The Task entity to display
#}
<div class="col-12 mb-3">
	<a href="{{ path('club_task_show', {id: task.id}) }}" class="text-decoration-none">
		<div class="card card-link" style="cursor: pointer;">
			<div class="card-body">
				<div
					class="d-flex align-items-start mb-3">
					{# Equipment Avatar - same style as equipment list #}
					<span class="avatar avatar-lg me-3 bg-{{ task.equipment.type.color }}-lt">
						<i class="ti {{ task.equipment.type.icon }} text-{{ task.equipment.type.color }}" style="font-size: 1.5rem;"></i>
					</span>

					{# Main content #}
					<div
						class="flex-grow-1">
						{# Equipment name (main title) #}
						<h3 class="card-title mb-1">
							{{ task.equipment.name }}
						</h3>

						{# Task name (subtitle) #}
						<div class="text-secondary mb-2">
							{{ task.title }}
						</div>

						{# Due date #}
						<div class="text-secondary small">
							{% if task.dueAt %}
								<i class="ti ti-calendar me-1"></i>
								{{ task.dueAt|date('d/m/Y') }}
							{% endif %}
						</div>
					</div>

					{# Badges on desktop - right side #}
					<div
						class="ms-3 d-none d-md-flex gap-2 align-items-start">
						{# Priority badge - show if task is priority or has priority subtasks #}
						{% if task.isPriorityOrHasPrioritySubTask %}
							<span class="badge bg-red-lt text-white">
								<i class="ti ti-flag me-1"></i>
								{{ 'priority'|trans }}
							</span>
						{% endif %}

						{# If task is cancelled, always show cancelled badge #}
						{% if task.status == 'cancelled' %}
							<span class="badge bg-danger-lt text-white">
								<i class="ti ti-x me-1"></i>
								{{ task.status|trans }}
							</span>
							{# If task has subtasks waiting for inspection #}
						{% elseif task.isWaitingForApproval %}
							<span class="badge bg-orange-lt text-white">
								<i class="ti ti-hourglass me-1"></i>
								{{ 'inspectionPending'|trans }}
							</span>
							{# Status badge with icon #}
						{% else %}
							<span class="badge bg-{{ task.status == 'closed' ? 'success' : (task.status == 'done' ? 'info' : 'info') }}-lt text-white">
								<i class="ti ti-{{ task.status == 'closed' ? 'circle-check' : (task.status == 'done' ? 'check' : 'circle') }} me-1"></i>
								{{ task.status|trans }}
							</span>
						{% endif %}

						{# Difficulty badge #}
						{% include 'component/difficultyBadge.html.twig' with {'label': task.difficultyLabel, 'color': task.difficultyColor} %}
					</div>
				</div>

				{# Badges on mobile - full width under avatar #}
				<div
					class="d-flex d-md-none gap-2 flex-wrap mb-3">
					{# Priority badge - show if task is priority or has priority subtasks #}
					{% if task.isPriorityOrHasPrioritySubTask %}
						<span class="badge bg-red text-white">
							<i class="ti ti-flag me-1"></i>
							{{ 'priority'|trans }}
						</span>
					{% endif %}

					{# If task is cancelled, always show cancelled badge #}
					{% if task.status == 'cancelled' %}
						<span class="badge bg-danger text-white">
							<i class="ti ti-x me-1"></i>
							{{ task.status|trans }}
						</span>
						{# If task has subtasks waiting for inspection #}
					{% elseif task.isWaitingForApproval %}
						<span class="badge bg-orange text-white">
							<i class="ti ti-hourglass me-1"></i>
							{{ 'inspectionPending'|trans }}
						</span>
						{# Status badge with icon #}
					{% else %}
						<span class="badge bg-{{ task.status == 'closed' ? 'success' : (task.status == 'done' ? 'info' : 'info') }} text-white">
							<i class="ti ti-{{ task.status == 'closed' ? 'circle-check' : (task.status == 'done' ? 'check' : 'circle') }} me-1"></i>
							{{ task.status|trans }}
						</span>
					{% endif %}

					{# Difficulty badge with icon and same style #}
					{% include 'component/difficultyBadge.html.twig' with {'label': task.difficultyLabel, 'color': task.difficultyColor} %}
				</div>

				{# Progress bar at the bottom - full width #}
				{% if task.subTasks|length > 0 %}
					{% set progress = 0 %}
					{% set closed = 0 %}
					{% for subtask in task.subTasks %}
						{% if subtask.status == 'closed' %}
							{% set closed = closed + 1 %}
						{% endif %}
					{% endfor %}
					{% set progress = (closed / task.subTasks|length * 100)|round %}
					<div class="progress progress-sm mb-2">
						<div class="progress-bar bg-{{ progress == 100 ? 'success' : 'primary' }}" style="width: {{ progress }}%">
							<span class="visually-hidden">{{ progress }}%</span>
						</div>
					</div>
					<div class="text-secondary small">
						{{ closed }}
						/
						{{ task.subTasks|length }}
						{{ 'subTasks'|trans|lower }}
					</div>
				{% endif %}
			</div>
		</div>
	</a>
</div>
