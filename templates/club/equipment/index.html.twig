{% extends 'club/base.html.twig' %}

{% block page_title %}
	{{ 'equipment'|trans }}
{% endblock %}

{% block page_actions %}
	{% if is_granted('MANAGE', club) %}
		<a href="{{ path('club_equipment_new') }}" class="btn btn-primary" style="min-height: 44px;">
			<i class="ti ti-plus me-2"></i>
			<span class="d-none d-sm-inline">{{ 'addEquipment'|trans }}</span>
			<span class="d-inline d-sm-none">{{ 'add'|trans }}</span>
		</a>
	{% endif %}
{% endblock %}

{% block page_content %}
	{% include 'component/filters.html.twig' with { form: filters } %}

	{# Equipment cards - Mobile-first design #}
	<div class="row">
		{% for equipment in equipments %}
			<div class="col-12 mb-3">
				<a href="{{ path('club_equipment_show', {id: equipment.id}) }}" class="text-decoration-none">
					<div
						class="card h-100 card-link {% if not equipment.active %}opacity-75{% endif %}" style="cursor: pointer; position: relative;">
						{# Owner badge - top right corner #}
						<div class="equipment-owner-badge">
							{% if equipment.isPrivate %}
								<span class="badge bg-orange-lt" title="{{ 'private'|trans }}">
									<i class="ti ti-user" style="font-size: 0.75rem;"></i>
									<span class="d-none d-sm-inline ms-1">{{ 'private'|trans }}</span>
								</span>
							{% else %}
								<span class="badge bg-blue-lt" title="{{ 'club'|trans }}">
									<i class="ti ti-building" style="font-size: 0.75rem;"></i>
									<span class="d-none d-sm-inline ms-1">{{ 'club'|trans }}</span>
								</span>
							{% endif %}
						</div>

						<div class="card-body">
							<div
								class="d-flex align-items-center">
								{# Avatar with icon based on type #}
								<span class="avatar avatar-lg me-3 bg-{{ equipment.type.value == 'glider' ? 'blue' : (equipment.type.value == 'facility' ? 'purple' : 'green') }}-lt">
									<i class="ti ti-{{ equipment.type.value == 'glider' ? 'plane' : (equipment.type.value == 'facility' ? 'building' : 'tool') }} text-{{ equipment.type.value == 'glider' ? 'blue' : (equipment.type.value == 'facility' ? 'purple' : 'green') }}" style="font-size: 1.5rem;"></i>
								</span>
								<div
									class="flex-fill">
									{# Title: Equipment name #}
									<h3 class="card-title mb-1 {% if not equipment.active %}text-secondary{% endif %}">
										{{ equipment.name }}
									</h3>
									{# Subtitle: Equipment type label #}
									<div class="text-secondary">
										{{ equipment.type.label|trans }}
									</div>
								</div>
								{# Pending tasks and subtasks count #}
								{% set counts = pendingCounts[equipment.id] %}
								{% if counts.tasks > 0 %}
									<div class="ms-3 text-end">
										<div class="d-flex flex-column gap-1">
											<span class="badge bg-warning" title="{{ 'pendingTasks'|trans }}">
												<i class="ti ti-checklist me-1"></i>
												{{ counts.tasks }}
												<span class="d-none d-sm-inline ms-1">{{ counts.tasks > 1 ? 'tasks' : 'task' }}</span>
											</span>
											{% if counts.subtasks > 0 %}
												<span class="badge bg-info" title="{{ 'pendingSubTasks'|trans }}">
													<i class="ti ti-checkbox me-1"></i>
													{{ counts.subtasks }}
													<span class="d-none d-sm-inline ms-1">{{ counts.subtasks > 1 ? 'subTasks' : 'subTask' }}</span>
												</span>
											{% endif %}
										</div>
									</div>
								{% endif %}
							</div>
						</div>
					</div>
				</a>
			</div>
		{% else %}
			<div class="col-12">
				<div class="card">
					<div class="card-body text-center text-secondary">
						<i class="ti ti-package-off" style="font-size: 3rem; opacity: 0.5;"></i>
						<p class="mt-3 mb-0">
							<em>{{ 'noEquipmentFound'|trans }}</em>
						</p>
						{% if is_granted('MANAGE', club) %}
							<a href="{{ path('club_equipment_new') }}" class="btn btn-primary mt-3" style="min-height: 44px;">
								<i class="ti ti-plus me-2"></i>
								{{ 'addEquipment'|trans }}
							</a>
						{% endif %}
					</div>
				</div>
			</div>
		{% endfor %}
	</div>

	{# Pagination #}
	<div class="d-flex justify-content-center mt-4">
		{{ pagination(equipments) }}
	</div>
{% endblock %}
