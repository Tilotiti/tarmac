{% extends 'club/base.html.twig' %}

{% block page_title %}
	{{ membership.user.fullname }}
{% endblock %}

{% block page_actions %}
	{% if is_granted('MANAGE', club) %}
		<div class="d-flex gap-2">
			<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal-edit-roles" style="min-height: 44px;">
				<i class="ti ti-edit me-2"></i>
				<span class="d-none d-sm-inline">{{ 'editRoles'|trans }}</span>
				<span class="d-inline d-sm-none">{{ 'roles'|trans }}</span>
			</button>
			<form method="post" action="{{ path('club_member_delete', {id: membership.id}) }}" onsubmit="return confirm('{{ 'confirmRemoveFromClub'|trans({'memberName': membership.user.fullname}) }}');">
				<button type="submit" class="btn btn-outline-danger" style="min-height: 44px;">
					<i class="ti ti-trash me-2"></i>
					<span class="d-none d-sm-inline">{{ 'removeFromClub'|trans }}</span>
					<span class="d-inline d-sm-none">{{ 'remove'|trans }}</span>
				</button>
			</form>
		</div>
	{% endif %}
{% endblock %}

{% block page_content %}
	{% if openModal %}
		<div data-auto-open-modal="modal-edit-roles"></div>
	{% endif %}
	{# Member Information Card #}
	<div class="card mb-3">
		<div class="card-header">
			<h3 class="card-title">{{ 'memberInformation'|trans }}</h3>
		</div>
		<div class="card-body">
			<div class="d-flex align-items-start flex-column flex-sm-row">
				<span class="avatar avatar-xl me-3 mb-3 mb-sm-0">{{ membership.user.firstname[:1] }}{{ membership.user.lastname[:1] }}</span>
				<div class="flex-fill">
					<h3 class="mb-1 {% if not membership.user.active %}text-danger{% endif %}">
						{{ membership.user.fullname }}
					</h3>
					<div class="text-secondary mb-2">
						<i class="ti ti-mail me-1"></i>
						{{ membership.user.email }}
					</div>
					{% if not membership.user.active %}
						<span class="badge bg-danger">{{ 'accountDisabled'|trans }}</span>
					{% endif %}
				</div>
				<div class="d-flex flex-wrap gap-2 align-items-start">
					{% if membership.isManager %}
						<span class="badge bg-blue-lt text-white fs-5 py-2 px-3">
							<i class="ti ti-user-star me-1"></i>
							{{ 'manager'|trans }}
						</span>
					{% endif %}
					{% if membership.isInspector %}
						<span class="badge bg-warning-lt text-white fs-5 py-2 px-3" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ 'qualifiedTooltip'|trans }}">
							<i class="ti ti-shield-check me-1"></i>
							{{ 'inspector'|trans }}
						</span>
					{% endif %}
					{% if membership.isPilote %}
						<span class="badge bg-purple-lt text-white fs-5 py-2 px-3" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ 'pilotTooltip'|trans }}">
							<i class="ti ti-plane me-1"></i>
							{{ 'pilot'|trans }}
						</span>
					{% endif %}
					{% if not membership.isManager and not membership.isInspector and not membership.isPilote %}
						<span class="badge bg-secondary-lt text-white fs-5 py-2 px-3">
							<i class="ti ti-user me-1"></i>
							{{ 'member'|trans }}
						</span>
					{% endif %}
				</div>
			</div>

			<hr class="my-4">

			<div class="row">
				<div class="col-12 col-sm-6 mb-3">
					<div class="text-secondary small mb-1">{{ 'joinedOn'|trans }}</div>
					<div>
						<i class="ti ti-calendar me-1"></i>
						{{ membership.joinedAt|date('d/m/Y à H:i') }}
					</div>
				</div>
				<div class="col-12 col-sm-6 mb-3">
					<div class="text-secondary small mb-1">{{ 'createdOn'|trans }}</div>
					<div>
						<i class="ti ti-clock me-1"></i>
						{{ membership.createdAt|date('d/m/Y à H:i') }}
					</div>
				</div>
			</div>
		</div>
	</div>

	{# Modal for editing roles - Only for managers #}
	{% if is_granted('MANAGE', club) %}
		<div class="modal modal-blur fade" id="modal-edit-roles" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered" role="document">
				<div class="modal-content">
					{{ form_start(form, {'attr': {'id': 'form-edit-roles'}}) }}
					<div class="modal-header">
						<h5 class="modal-title">{{ 'editRoles'|trans }}</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<div class="mb-3">
							<div class="form-check">
								<input type="checkbox" id="{{ form.isManager.vars.id }}" name="{{ form.isManager.vars.full_name }}" class="form-check-input" value="1" {% if form.isManager.vars.checked %} checked {% endif %}>
								<label class="form-check-label" for="{{ form.isManager.vars.id }}">
									<div>
										<i class="ti ti-user-star me-1"></i>
										{{ form.isManager.vars.label|trans }}
									</div>
									{% if form.isManager.vars.help %}
										<div class="text-secondary small">{{ form.isManager.vars.help|trans }}</div>
									{% endif %}
								</label>
							</div>
							{{ form_errors(form.isManager) }}
						</div>

						<div class="mb-3">
							<div class="form-check">
								<input type="checkbox" id="{{ form.isInspector.vars.id }}" name="{{ form.isInspector.vars.full_name }}" class="form-check-input" value="1" {% if form.isInspector.vars.checked %} checked {% endif %}>
								<label class="form-check-label" for="{{ form.isInspector.vars.id }}">
									<div>
										<i class="ti ti-shield-check me-1"></i>
										{{ form.isInspector.vars.label|trans }}
									</div>
									{% if form.isInspector.vars.help %}
										<div class="text-secondary small">{{ form.isInspector.vars.help|trans }}</div>
									{% endif %}
								</label>
							</div>
							{{ form_errors(form.isInspector) }}
						</div>

						<div>
							<div class="form-check">
								<input type="checkbox" id="{{ form.isPilote.vars.id }}" name="{{ form.isPilote.vars.full_name }}" class="form-check-input" value="1" {% if form.isPilote.vars.checked %} checked {% endif %}>
								<label class="form-check-label" for="{{ form.isPilote.vars.id }}">
									<div>
										<i class="ti ti-plane me-1"></i>
										{{ form.isPilote.vars.label|trans }}
									</div>
									{% if form.isPilote.vars.help %}
										<div class="text-secondary small">{{ form.isPilote.vars.help|trans }}</div>
									{% endif %}
								</label>
							</div>
							{{ form_errors(form.isPilote) }}
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" style="min-height: 44px;">
							<i class="ti ti-x me-2"></i>
							{{ 'cancel'|trans }}
						</button>
						<button type="submit" class="btn btn-primary" style="min-height: 44px;">
							<i class="ti ti-check me-2"></i>
							{{ 'save'|trans }}
						</button>
					</div>
					{# Mark fields as rendered so form_end doesn't render them again #}
					{% do form.isManager.setRendered %}
					{% do form.isInspector.setRendered %}
					{% do form.isPilote.setRendered %}
					{{ form_end(form) }}
				</div>
			</div>
		</div>
	{% endif %}
{% endblock %}
