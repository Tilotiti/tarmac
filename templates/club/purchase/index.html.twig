{% extends 'club/base.html.twig' %}

{% block page_title %}
	{{ 'purchases'|trans }}
{% endblock %}

{% block page_actions %}
	<a href="{{ path('club_purchase_new') }}" class="btn btn-primary" style="min-height: 44px;">
		<i class="ti ti-plus me-2"></i>
		<span class="d-none d-sm-inline">{{ 'createPurchase'|trans }}</span>
		<span class="d-inline d-sm-none">{{ 'add'|trans }}</span>
	</a>
{% endblock %}

{% block page_content %}
	{% include 'component/filters.html.twig' with { form: filters } %}

	{# Purchase cards - Full width #}
	<div class="row">
		{% for purchase in purchases %}
			<div class="col-12 mb-3">
				<a href="{{ path('club_purchase_show', {id: purchase.id}) }}" class="text-decoration-none">
					<div class="card card-link" style="cursor: pointer;">
						<div class="card-body">
							<div class="d-flex align-items-start mb-3">
								<div class="flex-fill">
									<h3 class="card-title mb-1 d-flex align-items-center gap-2">
										{{ purchase.name }}
										{% if purchase.description %}
											<i class="ti ti-info-circle text-info" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ purchase.description }}"></i>
										{% endif %}
										{% if purchase.requestImage %}
											<i class="ti ti-photo text-secondary" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ 'hasImages'|trans }}"></i>
										{% endif %}
										{% if purchase.billImage %}
											<i class="ti ti-file-invoice text-secondary" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ 'hasInvoice'|trans }}"></i>
										{% endif %}
									</h3>
									<div class="text-secondary small">
										{{ 'purchaseQuantity'|trans }}:
										{{ purchase.quantity }}
										-
										{{ purchase.createdAt|date('d/m/Y') }}
									</div>
								</div>
								<span class="badge bg-{{ purchase.status.value == 'complete' or purchase.status.value == 'reimbursed' ? 'success' : (purchase.status.value == 'cancelled' ? 'danger' : (purchase.status.value == 'pending_approval' ? 'warning' : 'info')) }}-lt text-white">
									{{ purchase.status.value|trans }}
								</span>
							</div>

							{# Progress bar based on status #}
							{% set progress = 0 %}
							{% set progressColor = 'info' %}
							{% if purchase.status.value == 'requested' %}
								{% set progress = 10 %}
								{% set progressColor = 'info' %}
							{% elseif purchase.status.value == 'pending_approval' %}
								{% set progress = 20 %}
								{% set progressColor = 'warning' %}
							{% elseif purchase.status.value == 'approved' %}
								{% set progress = 40 %}
								{% set progressColor = 'info' %}
							{% elseif purchase.status.value == 'purchased' %}
								{% set progress = 60 %}
								{% set progressColor = 'primary' %}
							{% elseif purchase.status.value == 'delivered' %}
								{% set progress = 80 %}
								{% set progressColor = 'info' %}
							{% elseif purchase.status.value == 'complete' %}
								{% set progress = 90 %}
								{% set progressColor = 'success' %}
							{% elseif purchase.status.value == 'reimbursed' %}
								{% set progress = 100 %}
								{% set progressColor = 'success' %}
							{% elseif purchase.status.value == 'cancelled' %}
								{% set progress = 0 %}
								{% set progressColor = 'danger' %}
							{% endif %}

							<div class="progress mb-2" style="height: 1.5rem;">
								<div class="progress-bar bg-{{ progressColor }}" style="width: {{ progress }}%">
									<span class="text-white fw-bold small">{{ progress }}%</span>
								</div>
							</div>
						</div>
					</div>
				</a>
			</div>
		{% else %}
			<div class="col-12">
				<div class="card">
					<div class="card-body text-center text-secondary">
						<i class="ti ti-shopping-cart" style="font-size: 3rem; opacity: 0.5;"></i>
						<p class="mt-3 mb-0">
							<em>{{ 'noPurchasesFound'|trans }}</em>
						</p>
						<a href="{{ path('club_purchase_new') }}" class="btn btn-primary mt-3" style="min-height: 44px;">
							<i class="ti ti-plus me-2"></i>
							{{ 'createPurchase'|trans }}
						</a>
					</div>
				</div>
			</div>
		{% endfor %}
	</div>

	{# Pagination #}
	<div class="d-flex justify-content-center mt-4">
		{{ pagination(purchases) }}
	</div>
{% endblock %}
