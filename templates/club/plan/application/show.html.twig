{% extends 'club/base.html.twig' %}

{% block page_title %}
	{{ 'planApplication'|trans }}
{% endblock %}

{% block page_actions %}
	{% if is_granted('MANAGE', club) and not application.isCancelled %}
		<div class="btn-list">
			<a href="{{ path('club_equipment_show', {id: application.equipment.id}) }}" class="btn">
				<i class="ti ti-device-analytics me-2"></i>
				{{ 'viewEquipment'|trans }}
			</a>
			<form method="post" action="{{ path('club_plan_application_cancel', {id: application.id}) }}" style="display: inline;" data-controller="confirm" data-confirm-title-value="{{ 'confirmCancel'|trans }}" data-confirm-yes-value="{{ 'confirm'|trans }}" data-confirm-cancel-value="{{ 'cancel'|trans }}">
				<button type="submit" class="btn btn-danger" data-confirm="{{ 'confirmCancelApplication'|trans }}">
					<i class="ti ti-x me-2"></i>
					{{ 'cancelApplication'|trans }}
				</button>
			</form>
		</div>
	{% elseif not is_granted('MANAGE', club) %}
		<a href="{{ path('club_equipment_show', {id: application.equipment.id}) }}" class="btn btn-primary">
			<i class="ti ti-device-analytics me-2"></i>
			{{ 'viewEquipment'|trans }}
		</a>
	{% endif %}
{% endblock %}

{% block page_content %}
	{# Application Information Card #}
	<div class="card mb-3">
		<div class="card-body">
			<div class="row mb-4">
				<div class="col">
					<h2 class="mb-3">{{ application.plan.name }}</h2>
					
					<div class="row">
						<div class="col-12 col-md-6 mb-3">
							<div class="text-secondary small mb-1">{{ 'equipment'|trans }}</div>
							<div>
								<a href="{{ path('club_equipment_show', {id: application.equipment.id}) }}" class="text-reset">
									<i class="ti {{ application.equipment.type.icon }} me-1"></i>
									{{ application.equipment.name }}
								</a>
							</div>
						</div>

						<div class="col-12 col-md-6 mb-3">
							<div class="text-secondary small mb-1">{{ 'plan'|trans }}</div>
							<div>
								<a href="{{ path('club_plan_show', {id: application.plan.id}) }}" class="text-reset">
									<i class="ti ti-clipboard-check me-1"></i>
									{{ application.plan.name }}
								</a>
							</div>
						</div>

						<div class="col-12 col-md-6 mb-3">
							<div class="text-secondary small mb-1">{{ 'appliedAt'|trans }}</div>
							<div>
								<i class="ti ti-calendar me-1"></i>
								{{ application.appliedAt|date('d/m/Y à H:i') }}
							</div>
						</div>

						<div class="col-12 col-md-6 mb-3">
							<div class="text-secondary small mb-1">{{ 'appliedBy'|trans }}</div>
							<div>
								<i class="ti ti-user me-1"></i>
								{{ application.appliedBy.fullname }}
							</div>
						</div>

						{% if application.dueAt %}
							<div class="col-12 col-md-6 mb-3">
								<div class="text-secondary small mb-1">{{ 'dueDate'|trans }}</div>
								<div>
									<i class="ti ti-calendar-due me-1"></i>
									{{ application.dueAt|date('d/m/Y') }}
								</div>
							</div>
						{% endif %}

						{% if application.isCancelled %}
							<div class="col-12 mb-3">
								<div class="alert alert-warning mb-0">
									<div class="d-flex align-items-center">
										<i class="ti ti-alert-triangle me-2"></i>
										<div>
											<strong>{{ 'cancelled'|trans }}</strong>
											<div class="small">
												{{ 'cancelledAt'|trans }}: {{ application.cancelledAt|date('d/m/Y à H:i') }}
												{% if application.cancelledBy %}
													- {{ 'by'|trans }}: {{ application.cancelledBy.fullname }}
												{% endif %}
											</div>
										</div>
									</div>
								</div>
							</div>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>

	{# Tasks Section #}
	<div class="mb-3">
		<div class="d-flex align-items-center mb-3">
			<h3 class="mb-0">
				<i class="ti ti-checklist me-2"></i>
				{{ 'tasks'|trans }}
			</h3>
			<span class="badge bg-primary text-white ms-2">{{ tasks|length }}</span>
		</div>
		
		{% if tasks|length > 0 %}
			{# Task cards - Mobile-first design #}
			<div class="row">
				{% for task in tasks %}
					{% include 'component/taskCard.html.twig' with {'task': task} %}
				{% endfor %}
			</div>
		{% else %}
			<div class="empty">
				<div class="empty-icon">
					<i class="ti ti-checklist icon-lg"></i>
				</div>
				<p class="empty-title">{{ 'noTasks'|trans }}</p>
				<p class="empty-subtitle text-secondary">
					{{ 'noTasksForApplication'|trans }}
				</p>
			</div>
		{% endif %}
	</div>
{% endblock %}



