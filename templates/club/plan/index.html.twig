{% extends "club/base.html.twig" %}

{% block page_title %}
	{{ 'plans'|trans }}
{% endblock %}

{% block page_actions %}
	<a href="{{ path('club_plan_new') }}" class="btn btn-primary">
		<i class="ti ti-plus"></i>
		{{ 'newPlan'|trans }}
	</a>
{% endblock %}

{% block page_content %}
	{# Search and Filter #}
	{% include 'component/filters.html.twig' with {'form': filters} %}

	{# Plans List #}
	<div class="row row-cards">
		{% if plans|length > 0 %}
			{% for plan in plans %}
				{% set totalSubTasks = 0 %}
				{% for task in plan.taskTemplates %}
					{% set totalSubTasks = totalSubTasks + task.subTaskTemplates|length %}
				{% endfor %}

				<div class="col-12">
					<a href="{{ path('club_plan_show', {id: plan.id}) }}" class="card card-link">
						<div class="card-body">
							<div class="row align-items-center">
								<div class="col">
									<h3 class="card-title mb-1">
										{{ plan.name }}
										{% if plan.description %}
											<i class="ti ti-info-circle ms-2 text-muted" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ plan.description }}"></i>
										{% endif %}
									</h3>
									<div class="text-secondary">
										<span class="badge bg-{{ plan.equipmentType.value == 'glider' ? 'blue' : 'green' }} text-white me-2">
											<i class="ti ti-{{ plan.equipmentType.value == 'glider' ? 'plane' : 'building' }} me-1"></i>
											{{ (plan.equipmentType.value ~ 'Type')|trans }}
										</span>
										<span class="badge bg-primary text-white me-2">
											<i class="ti ti-checkbox me-1"></i>
											{{ plan.taskTemplates|length }}
											{{ 'tasks'|trans|lower }}
										</span>
										{% if totalSubTasks > 0 %}
											<span class="badge bg-secondary text-white">
												<i class="ti ti-list-check me-1"></i>
												{{ totalSubTasks }}
												{{ 'subTasks'|trans|lower }}
											</span>
										{% endif %}
									</div>
								</div>
								<div class="col-auto">
									<i class="ti ti-chevron-right text-muted"></i>
								</div>
							</div>
						</div>
					</a>
				</div>
			{% endfor %}
		{% else %}
			<div class="col-12">
				<div class="card">
					<div class="card-body">
						<div class="empty">
							<div class="empty-icon">
								<i class="ti ti-file-check icon-lg"></i>
							</div>
							<p class="empty-title">{{ 'noPlans'|trans }}</p>
							<p class="empty-subtitle text-secondary">
								{{ 'noPlansDescription'|trans }}
							</p>
							<div class="empty-action">
								<a href="{{ path('club_plan_new') }}" class="btn btn-primary">
									<i class="ti ti-plus"></i>
									{{ 'newPlan'|trans }}
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		{% endif %}
	</div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	 <script>
							// Enable Bootstrap tooltips
							document.addEventListener('DOMContentLoaded', function() {
								const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
								const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
							});
						</script>
{% endblock %}
