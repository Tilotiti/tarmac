{% extends 'app/base.html.twig' %}

{% form_theme filters 'component/filters.html.twig' %}

{% block title %}Gestion des utilisateurs
{% endblock %}

{% block body %}
	<div class="page-header d-print-none">
		<div class="container-xl">
			<div class="row g-2 align-items-center">
				<div class="col">
					<h2 class="page-title">
						Utilisateurs
					</h2>
				</div>
				<div class="col-auto ms-auto d-print-none">
					<a href="{{ path('app_user_new') }}" class="btn btn-primary" style="min-height: 44px;">
						<i class="ti ti-plus me-2"></i>
						<span class="d-none d-sm-inline">Inviter un utilisateur</span>
						<span class="d-inline d-sm-none">Inviter</span>
					</a>
				</div>
			</div>
		</div>
	</div>

	<div class="page-body">
		<div class="container-xl">

			{% include 'component/filters.html.twig' with { form: filters } %}

			{# User cards - Mobile-first design for all screen sizes #}
			<div class="row">
				{% for user in users %}
					<div class="col-12 col-md-6 col-lg-4 mb-3">
						<a href="{{ path('app_user_show', {id: user.id}) }}" class="card h-100 text-decoration-none" style="transition: all 0.2s ease; cursor: pointer;">
							<div class="card-body">
								<div class="d-flex align-items-center mb-3">
									<span class="avatar me-3">{{ user.firstname[:1] }}{{ user.lastname[:1] }}</span>
									<div class="flex-fill">
										<div class="font-weight-medium text-dark">{{ user.fullname }}</div>
										<div class="text-secondary">{{ user.email }}</div>
									</div>
									<i class="ti ti-arrow-right text-muted"></i>
								</div>

								<div class="row">
									<div class="col-6">
										<div class="text-muted small">Rôles</div>
										<div>
											{% for role in user.roles %}
												{% if role != 'ROLE_USER' %}
													<span class="badge bg-blue-lt me-1">
														{% if role == 'ROLE_ADMIN' %}
															Administrateur
														{% elseif role == 'ROLE_MANAGER' %}
															Manager
														{% elseif role == 'ROLE_INSPECTOR' %}
															Inspecteur
														{% endif %}
													</span>
												{% endif %}
											{% endfor %}
											{% if user.roles|length == 1 and 'ROLE_USER' in user.roles %}
												<span class="text-muted small">Utilisateur standard</span>
											{% endif %}
										</div>
									</div>
									<div class="col-6">
										<div class="text-muted small">Statut</div>
										<div>
											{% if user.isPending %}
												<span class="badge bg-yellow-lt">En attente</span>
											{% elseif user.active %}
												<span class="badge bg-green-lt">Actif</span>
											{% else %}
												<span class="badge bg-secondary-lt">Inactif</span>
											{% endif %}
										</div>
									</div>
								</div>
							</div>
						</a>
					</div>
				{% else %}
					<div class="col-12">
						<div class="card">
							<div class="card-body text-center text-secondary">
								<em>Aucun utilisateur trouvé</em>
							</div>
						</div>
					</div>
				{% endfor %}
			</div>

			{# Pagination #}
			<div class="d-flex justify-content-center mt-4">
				{{ pagination(users) }}
			</div>
		</div>
	</div>
{% endblock %}
